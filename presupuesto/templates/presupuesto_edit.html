{% extends "base_modal_form.html" %}

{% block formulario %}

<form action="" method="post" id="myform">

  {% csrf_token %}

<div class="form-group filtra-campos">

  {% for campo in form %}

    <p id="{{campo.name}}">
        <label for="{{campo.id_for_label}}">{{ campo.label }}</label>
        {{ campo }}
    </p>

{% endfor %}

</div>
<button type="submit" class="btn btn-default" style="float:right;margin-right:15px;">Guardar</button>
</form>

{% endblock formulario %}

{% block style %}

<link rel="stylesheet" href="/static/css/presupuestoForm/preDatosPersonales.css">

{% endblock style %}

{% block js_form %}

<script src="/static/js/presupuestoForm/preDatosPersonales.js"></script>
<script type="text/javascript">

$('#myform').submit(function(){
    var id = $(parent.document.getElementsByClassName("id_opcionDatosPersonales")).attr('id');
    var action = "../../editar/"+id+"/";
    var that = $(this)
    var closep = parent.document.getElementById("btn-cerrarDatosPersonales");
    $.ajax({
        url: action,
        type: 'POST',
        data: that.serialize()
        ,success: function(data){
          if (data.estatus=="ok"){
            var closep = parent.document.getElementById("btn-cerrarDatosPersonales");
            var msj = parent.document.getElementById('msjGuardado');
            $(closep).click();
            $(msj).text('Guardado con exito');
            $(msj).fadeIn();
            setTimeout(function() {$(msj).fadeOut();}, 3000);
            asyncChange();
          }
        }
    });
 return false;
});
    function asyncChange()
{
    var request;
    var id3 = $(parent.document.getElementsByClassName("id_opcionDatosPersonales")).attr('id');
    var url2 = "/presupuesto/ficha/datospersonales/"+id3+"/";

    if (window.XMLHttpRequest) {
        request = new window.XMLHttpRequest();
    } else {
        request = new window.ActiveXObject("Microsoft.XMLHTTP");
    }

    request.open("GET", url2, true);
    request.send();

    request.onreadystatechange = function()
    {
        if (request.readyState == 4 && request.status == 200)
        {
            parent.document.getElementById("myLabel").innerHTML = request.responseText;
        }
    }
}
</script>

{% endblock js_form %}
