{% extends 'base_modal_form.html' %}

{% block formulario %}

            <div class="modal-body">

                {% block validacion_modal %}<p>Â¿Realmente desea eliminar el registro: <strong id="">

                    {{ object }}

                </strong>?</p>{% endblock validacion_modal %}

            </div>
            <div class="modal-footer">
                <form method="post" id="myform">

                    {% csrf_token %}

                    <a onclick="cerrar();" class="btn btn-default">No</a>
                    <input type="submit" class="btn btn-default" value="Si" />
                </form>
            </div>

{% endblock formulario %}

{% block js_form %}

<script>
$('#myform').submit(function(){
    var id = $(parent.document.getElementsByClassName("id_opcionEliminar")).attr('src');
    var action = id;
    var that = $(this);
    $.ajax({
        url: action,
        type: 'POST',
        data: that.serialize()
        ,success: function(data){
            var modalp = parent.document.getElementById('myModalAmbiente');
            var divp = parent.document.getElementsByClassName("modal-backdrop");
            var bodyp = parent.document.getElementById('id_body');
            var closep = parent.document.getElementById("cerrarEliminar");
            var eliminar = parent.document.getElementById("msjEliminado");

          if (data.estatus=="ok"){
            cerrar();
            setTimeout(function() {
            parent.location.reload();
            },1000);
            $(eliminar).text('Eliminado');
            $(eliminar).fadeIn();
          }else{
            alert('no se elimino');
            cerrar();
          }

        },
        error: function (ajaxContext) {
        alert('No se puede eliminar por que tiene servicios asociado.');
        setTimeout(function() {cerrar();},0);
    }
    });
    return false;
});
function cerrar() {var closep = parent.document.getElementById("cerrarEliminar");$(closep).click();};
</script>

{% endblock js_form %}
