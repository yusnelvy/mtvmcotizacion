{% extends "inicio/base_edit.html" %}

{% block titulo %}

<title>Presupuesto</title>

{% endblock titulo %}

{% block col_edit %}

class="col-md-7"

{% endblock col_edit %}

{% block titulo_form %}

  <h2>Agregar detalle</h2>

{% endblock titulo_form %}

{% block cuerpo_form %}

<style>
.campo>label,li label{font-family: inherit;font: inherit;}
.campo4,.campo5,.campo6,.campo7,.campo11,.campo12,.campo13,.campo14,.campo15,.campo16,.campo17,.campo18,.campo19,.campo20,.campo21,.campo22,.campo23,.campo24,#capacidadmueble,#densidadcontenido,#volmaterial,#pesomaterial{display: none;}
.campo0>select,.campo1>select,input[type=number],.campo2>select{
  box-sizing: border-box;
  border-radius: 6px;
  box-shadow: 0px 1px 1px rgba(0, 0, 0, 0.075) inset;
  font-size: 18px;
  height: 46px;
  line-height: 1.33333;
  padding: 10px 16px;
  display:block;
  background-color: #FFF;
  background-image: none;
  border: 1px solid #CCC;
  color: #555;
  font-family: inherit;
  font: inherit;
  margin: 0px;
  transition: border-color 0.15s ease-in-out 0s, box-shadow 0.15s ease-in-out 0s;
  width: 100%;
}
.campo0>select:focus,.campo1>select:focus,input[type=number]:focus,.campo2>select:focus{
  border-color: #66afe9;
  outline: 0;
  -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, .6);
  box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, .6);
}
.campo0,.campo1,.campo2{width: 32%;}
.campo8,.campo9,.campo10{width: 32%;}
.campo3{width: 100%;margin-top: 20px;}
.ul-list{list-style: none;}
#id_lista_ocupacion li{display: inline-table;margin-left: 30px;}
</style>

<div class="form-group campo">

  {% for i in form %}

    <label for="{{ i.id_for_label }}" class="campo{{forloop.counter0}}">{{i.label}} {{i}}</label>

  {% endfor %}

<input type="text" id="capacidadmueble">
<input type="text" id="densidadcontenido">
<input type="text" id="volmaterial">
<input type="text" id="pesomaterial">
</div>
{{form_data}}

<script>
document.getElementById('id_lista_ambiente').focus();
$( "#id_lista_ocupacion" ).addClass( "ul-list" );
/**
 * jQuery Select-Filter 0.0.1
 *
 * Dynamically filter long <select> lists through an (automatically created)
 * input[type="text"] control.
 *
 * https://github.com/kfr2/jquery-select-filter
 *
 * License: GPL - http://www.gnu.org/licenses/gpl.html
 */
(function($) {
    $.fn.selectFilter = function(options) {
        var defaults = {
            // searching should be case sensitive
            'caseSensitive': false,

            // clear input box on Escape press
            'clearInputOnEscape': true,

            // disable regular expressions in search input
            'disableRegex': true,

            // class to associate with filter element
            'filterClass': 'filter-bar',

            // whether the input element should be appended to the DOM
            // either 'below' (default) or 'above' the select element
            'inputLocation': 'below',

            // text to display as placeholder for the filter bar
            'inputPlaceholder': 'type to filter list',

            // the minimum number of characters required to begin initial filtering
            'minimumCharacters': 3,

            // the minimum size attribute for the select element this plugin is called on
            'minimumSelectElementSize': 3,

            // amount of time to delay filter between keypresses (in ms)
            'searchDelay': 200,

            // begin searching strickly from beginning of each option
            'searchFromBeginning': false,

            // the width for the select/input boxes. If -1, use the width of the calling element before filtering occurs
            // the width may be numeric (in which case px will be appended) or another valid CSS designator (ex: %)
            'width': -1
        };

        // Overwrite default settings with user provided ones.
        options = $.extend(defaults, options);


        // Note the calling element -- i.e., the select element -- and its
        // children.
        var self = this;
        if (!self || self.get(0).tagName !== 'SELECT') {
            return false;
        }

        // Keep a copy of the children of the calling element.
        var clone = self.children().clone();

        // Lock the calling element's width to prevent it from dynamically
        // resizing when the maximum length of its children changes.
        // Otherwise, the calling element may resize as its children
        // are removed/added.
        var width = options.width;
        if (width === -1) {
            width = self.width();
        }

        var widthStr = width.toString();
        if (isFinite(widthStr)) {
            widthStr += 'px';
        }

        self.css('width', widthStr);


        // Used for connection between input and select elements.
        var name = '';
        if (typeof(self.attr('name')) === 'undefined') {
            name = 'undefined_name';
        }
        else {
            name = self.attr('name').replace(/\]/g, '').replace(/\[/g, '');
        }


        // Ascertain the calling element's size is at least mininumSelectElementSize
        if(typeof(self.attr('size')) === 'undefined' || self.attr('size') < options.minimumSelectElementSize)
        {
            self.attr('size', options.minimumSelectElementSize);
        }

        // Create the filter element and attach it to the calling element.
        var filterElement = $('<input>', {
            id: 'input_' + name,
            type: 'text',
            placeholder: options.inputPlaceholder,
            class: options.filterClass,
            style: 'display: block; width: ' + widthStr
        });


        self.addClass(name + '_select').css({'display': 'block'});

        if (options.inputLocation === 'above') {
            self.before(filterElement);
        }
        else {
            self.after(filterElement);
        }



        // Clear the input box when escape is pressed.
        if (options.clearInputOnEscape) {
            $('#input_' + name).on('keydown', function(key) {
                if (key.which === 27) {
                    $(this).val('');
                }
            });
        }


        /**
         * Filtering logic
         */
        var keyDelayTimeout;
        var filteringStarted = false;
        var oldSearchText = null;

        $('#input_' + name).on('keyup', function() {
            clearTimeout(keyDelayTimeout);

            var searchText = $(this).val();
            if (!filteringStarted && searchText.length < options.minimumCharacters) {
                return;
            }

            filteringStarted = true;

            // Add timeout to filtering for performance reasons.
            keyDelayTimeout = setTimeout(function() {
                // Refresh the list of items if the search string has
                // grown shorter as the user is backtracking.
                // TODO: it might be neat to consider caching copies of results
                // for various phrases and swap them into place as the user
                // backtracks and enters previous queries.
                if (oldSearchText !== null) {
                    if (searchText.length <= oldSearchText.length) {
                        self.children().remove();
                        self.append(clone);
                    }
                }
                oldSearchText = searchText;

                if (!options.caseSensitive) {
                    searchText = searchText.toLowerCase();
                }

                if (options.disableRegex) {
                    searchText = searchText.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                }

                if (options.searchFromBeginning) {
                    searchText = '^' + searchText;
                }

                var pattern = new RegExp(searchText);
                self.children().each(function(i, selected) {
                    var option_value = $(this).text();
                    if (!options.caseSensitive) {
                        option_value = option_value.toLowerCase();
                    }

                    if (!pattern.test(option_value)) {
                        $(selected).remove();
                    }
                });

                if (self.children().length === 0) {
                    self.append('<option disabled>(No results.)</option>');
                }

                clearTimeout(keyDelayTimeout);
            }, options.searchDelay);
        });


        return this;
    };
})(jQuery);
 $(document).ready(function() {
        $('select').selectFilter();
    });
</script>
{% endblock cuerpo_form %}

{% block js_sup %}
<script>
$(document).ready(function(){
  $("#id_lista_ambiente").on("change", function(){
    id_lista_ambiente = $("#id_lista_ambiente").val();
    $("#id_ambiente").val(id_lista_ambiente);
    $.get('/presupuesto/detalle/nuevo',
      {id_lista_ambiente: id_lista_ambiente},
      function(data){
        $("#id_ambiente").val(data[0].ambiente);
      });
  });

  $("#id_lista_mueble").on("change", function(){
    id_lista_mueble = $("#id_lista_mueble").val();
    $.get('/presupuesto/detalle/nuevo',
      {id_lista_mueble: id_lista_mueble},
      function(data){
        $("#id_mueble").val(data[0].mueble);
        $("#id_ocupacidad").val(data[0].descripocupacion);
        $("#id_valor_ocupacidad").val(data[0].valorocupacion);
        $("#id_lista_ocupacion").val(data[0].ocupacion);
        $("#capacidadmueble").val(data[0].capacidadmueble);
        $("#densidadcontenido").val(data[0].densidadcontenido);
        $("#volmaterial").val(data[0].vol_contenedor);
        $("#id_capacidad_volumen_contenedor").val(data[0].capacidadvolcontenedor);
        $("#id_capacidad_peso_contenedor").val(data[0].capacidadpesocontenedor);
        $("#id_descripcion_contenedor").val(data[0].descripcioncontenedor);
        $("#pesomaterial").val(data[0].peso_contenedor);

        lista_ocupacion = $("input[name=lista_ocupacion]");
        for(var i=0; i<lista_ocupacion.length; i++){
          if (data[0].ocupacion==lista_ocupacion[i].value){
            $(lista_ocupacion[i]).attr("checked","checked");
          }
        }
      });
});

$("#id_lista_tamano").on("change", function(){
  id_lista_tamano = $("#id_lista_tamano").val();
  id_lista_mueble = $("#id_lista_mueble").val();
  $.get('/presupuesto/detalle/nuevo',
    {id_lista_tamano: id_lista_tamano, id_lista_mueble: id_lista_mueble},
    function(data){
      $("#id_tamano").val(data[0].tamano);
      $("#id_ancho").val(data[0].ancho);
      $("#id_largo").val(data[0].largo);
      $("#id_alto").val(data[0].alto);
      $("#id_densidad").val(data[0].densidad);
      $("#id_peso").val(data[0].peso);
      $("#id_valor_densidad").val(data[0].valor_densidad);
      $("#id_volumen_mueble").val(data[0].volumen_mueble);

      volcontenido = calcular_volcontenido($("#capacidadmueble").val(),$("#id_volumen_mueble").val(),$("#id_valor_ocupacidad").val());

      $("#id_volumen_contenido").val(volcontenido);

      peso_contenido = calcular_pesocontenido($("#id_volumen_contenido").val(),$("#densidadcontenido").val());
      $("#id_peso_contenido").val(peso_contenido);

      cant_contenedor = calcular_cantidadcontenedor($("#id_volumen_contenido").val(),$("#id_capacidad_volumen_contenedor").val(),$("#id_peso_contenido").val(),$("#id_capacidad_peso_contenedor").val());

      $("#id_cantidad_contenedor").val(cant_contenedor);

      volcontenedor = calcular_volcontenedor($("#id_cantidad_contenedor").val(),$("#volmaterial").val());
      $("#id_volumen_contenedor").val(volcontenedor);

      pesocontenedor = calcular_pesocontenedor($("#id_cantidad_contenedor").val(),$("#pesomaterial").val());
      $("#id_peso_contenedor").val(pesocontenedor);
    });
});

$("input[name=lista_ocupacion]").click(function () {
  id_ocupacion = $('input[name=lista_ocupacion]:checked').val();
  $.get('/presupuesto/detalle/nuevo',
    {id_ocupacion: id_ocupacion},
    function(data){
      $("#id_ocupacidad").val(data[0].ocupacion);
      $("#id_valor_ocupacidad").val(data[0].valorocupacion);
      volcontenido = calcular_volcontenido($("#capacidadmueble").val(),$("#id_volumen_mueble").val(),$("#id_valor_ocupacidad").val());

      $("#id_volumen_contenido").val(volcontenido);

      peso_contenido = calcular_pesocontenido($("#id_volumen_contenido").val(),$("#densidadcontenido").val());
      $("#id_peso_contenido").val(peso_contenido);

      cant_contenedor = calcular_cantidadcontenedor($("#id_volumen_contenido").val(),$("#id_capacidad_volumen_contenedor").val(),$("#id_peso_contenido").val(),$("#id_capacidad_peso_contenedor").val());

      $("#id_cantidad_contenedor").val(cant_contenedor);

      volcontenedor = calcular_volcontenedor($("#id_cantidad_contenedor").val(),$("#volmaterial").val());
      $("#id_volumen_contenedor").val(volcontenedor);

      pesocontenedor = calcular_pesocontenedor($("#id_cantidad_contenedor").val(),$("#pesomaterial").val());
      $("#id_peso_contenedor").val(pesocontenedor);
    });
});

$('#id_ancho').on('change', function(){
  densidad = calcular_densidad($("#id_peso").val(),$(this).val(),$("#id_largo").val(),$("#id_alto").val());
  volumen = calcular_volumen($(this).val(),$("#id_largo").val(),$("#id_alto").val());
  $("#id_valor_densidad").val(densidad);
  $("#id_volumen_mueble").val(volumen);

});

$('#id_largo').on('change', function(){
  densidad = calcular_densidad($("#id_peso").val(),$("#id_ancho").val(),$(this).val(),$("#id_alto").val());
  volumen = calcular_volumen($("#id_ancho").val(),$(this).val(),$("#id_alto").val());
  $("#id_valor_densidad").val(densidad);
  $("#id_volumen_mueble").val(volumen);
});

$('#id_alto').on('change', function(){
  densidad = calcular_densidad($("#id_peso").val(),$("#id_ancho").val(),$("#id_largo").val(),$(this).val());
  volumen = calcular_volumen($("#id_ancho").val(),$("#id_largo").val(),$(this).val());
  $("#id_valor_densidad").val(densidad);
  $("#id_volumen_mueble").val(volumen);
});

});
</script>

<script>
function calcular_densidad(peso,ancho,largo,alto){
  var resultado = 0;
  resultado= (peso/((ancho*largo*alto)/1000000));

  return resultado.toFixed(2);
}

function calcular_volumen(ancho,largo,alto){
  var resultado = 0;
  resultado= (ancho*largo*alto)/1000000;

  return resultado.toFixed(2);
}

function calcular_volcontenido(cap_mueble,vol_mueble,ocupacidad){
  var resultado = 0;
  resultado= (cap_mueble*vol_mueble*ocupacidad);

  return resultado.toFixed(2);

}

function calcular_pesocontenido(vol_contenido,densidadcontenido){
  var resultado = 0;
  resultado= (vol_contenido*densidadcontenido)

  return resultado.toFixed(2);

}

function calcular_cantidadcontenedor(vol_contenido,cap_volcontenedor,peso_contenido,cap_pesocontenedor){
  var resultado = 0;
  var cant_volumen = 0;
  var cant_peso = 0;

  cant_volumen = (volcontenido/cap_volcontenedor);
  cant_volumen = Math.ceil(cant_volumen);
  cant_peso = (peso_contenido/ cap_pesocontenedor);
  cant_peso = Math.ceil(cant_peso);


  if (cant_volumen > cant_peso) {
    resultado = cant_volumen;
  }else{
    resultado = cant_peso;
  }

  return resultado;

}

function calcular_volcontenedor(cant_contenedor,vol_material){
  var resultado = 0;
  resultado= (cant_contenedor*vol_material);

  return resultado.toFixed(2);

}

function calcular_pesocontenedor(cant_contenedor,peso_material){
  var resultado = 0;
  resultado= (cant_contenedor*peso_material)

  return resultado.toFixed(2);

}

</script>

{% endblock js_sup %}

{% block ayuda %}

<div class="well well-lg">
  <p>La <strong>Presupuesto</strong>  es la acción y efecto de cotizar, poner precio a algo, estimar a alguien o algo en relación con un fin. el documento informa y establece el valor del servicios.</p>
</div>

{% endblock ayuda %}
